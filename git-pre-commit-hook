#!/usr/bin/bash
#
# Runs commands which help to ensure consistency across codebases.


# if a python project with a virtual environment:
#  - update its pip requirements
#  - run the black formatter
if [ -d "venv" ]; then
    source venv/bin/activate
    pip freeze > requirements.txt
    black .
    deactivate
    git add requirements.txt
fi


# if an NPM project with a Prettier configuration file:
#  - run the prettier formatter
if [ -f "package.json" ] && \
        [ -f "package-lock.json" ] && \
        [ -f ".prettierrc.json" ] && \
        [ -f ".prettierignore"]; then
    npx prettier --write .
    npx prettier --write "**/*.html.jinja" --parser html  # format .html.jinja files as html
fi


# re-adds files which are already intended to be committed
# ensuring formatting changes are included in the commit
git add `git diff --staged --name-only`
