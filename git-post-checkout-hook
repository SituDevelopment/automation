#!/usr/bin/bash
#
# Runs commands which initialise the local development environment after checking out a
# Git repository.
#
# These commands help to ensure that the local development environment is consistent
# across all developers working on all projects.


find-by-extension ".py" > /dev/null
if [ $? -eq 0 ]; then
    echo "Found Python!"

    if [ ! -d "venv" ]; then
        echo "Creating virtual environment..."
        python3 -m venv venv > /dev/null
    fi

    source venv/bin/activate > /dev/null

    echo "Ensuring updated depencencies (including Black) are installed..."
    pip install --upgrade pip > /dev/null
    pip install black > /dev/null
    pip install isort > /dev/null
    if [ -f "requirements.txt" ]; then
        pip install -r requirements.txt > /dev/null
    fi

    deactivate > /dev/null
fi


find-by-extension ".html" ".html.jinja" ".css" ".json" ".yaml" ".yml" ".js" ".ts" ".jsx" ".tsx" ".cjs" > /dev/null
if [ $? -eq 0 ]; then
    echo "Found web stuff!"

    if [ ! -f "package.json" ]; then
        echo "Initializing npm project..."
        npm init -y > /dev/null
    fi

    echo "Ensuring updated depencencies (including Prettier) are installed..."
    npm install > /dev/null
    npm install prettier --save-dev > /dev/null

    echo "Ensuring Prettier configuration files are present..."
    if [ ! -f ".prettierrc.json" ]; then
        cp /usr/local/share/style/prettierrc.json .prettierrc.json > /dev/null
    fi

    if [ ! -f ".prettierignore" ]; then
        cp /usr/local/share/style/prettierignore .prettierignore > /dev/null
    fi
fi
